---
- name: Stop all Docker Containers and Reset Database
  hosts: localhost
  connection: local
  gather_facts: false
  vars:
    project_root: "{{ playbook_dir }}/.."

  tasks:
    - name: Warning
      ansible.builtin.debug:
        msg: "‚ö†Ô∏è  WARNING: This will DELETE all database volumes and data!"

    - name: Confirm reset
      ansible.builtin.pause:
        prompt: "Are you sure you want to reset the database? Press ENTER to continue or Ctrl+C to cancel"

    # Stop Web Server
    - name: Stop Web Server
      community.docker.docker_compose_v2:
        project_src: "{{ project_root }}/Apache"
        files:
          - docker-compose.web.yml
        state: absent

    # Stop DNS Server
    - name: Stop DNS Server
      community.docker.docker_compose_v2:
        project_src: "{{ project_root }}/bind"
        files:
          - docker-compose.bind.yml
        state: absent

    # Stop Nagios
    - name: Stop Nagios
      community.docker.docker_compose_v2:
        project_src: "{{ project_root }}/nagios"
        files:
          - docker-compose.yml
        state: absent

    # Stop Database and REMOVE volumes
    - name: Stop Database and Remove Volumes
      community.docker.docker_compose_v2:
        project_src: "{{ project_root }}/mariadb"
        files:
          - docker-compose.db.yml
        state: absent
        remove_volumes: true

    - name: Final Status
      ansible.builtin.debug:
        msg: "üõë All containers stopped. Database volumes DELETED."
